  100 HIMEM=&21B8:PROCI
  110 FORZ=0TO2STEP2:P%=HIMEM
  120   [OPTZ:.Q% JSRS%
  130   .GO JSRR%:JSRscr
  140   JSRmp:JSRnp:JSRmg
  150   JSRmb:JSRnb:JSRmbo:JSRnbo:JSRpg
  160   JSRh0:JSRsor:LDA#&81:LDY#&FF:LDX#&8F:JSR&FFF4:INX:BNEGO:RTS
  170   .S% LDA#0:STApicn:STAgex:STAba+1:STA&2F37:STAsc:STAsc+1:STAsc+2:JSRC%:JSRV%:CLC:LDA#4:STAno:JSRE%
  180   LDA#&80:STAgex+2:LDA#&32:STAgex+3:LDX#4:STXgex+1:DEX:.pmi JSRmini:CLC:LDAgex+2:ADC#&20:STAgex+2:DEX:BNEpmi
  190   .col LDX#15:LDY#7:.co1 JSRD%:DEX:CPX#7:BNEco1:STXra1
  200   .ppos LDA#&3A:STA&81:LDA#&81:STA&82:LDX#1:LDY#8
  210   .pp1 LDA#&81:STA!pls,X:INX:TYA:CLC:ADC#&50:STA!pls,X:TAY:INX:LDA&81:ADC#0:STA!pls,X:STA&81:CLC:INX:LDA&82:ADC#10:STA&82:STA!pls,X
  220   INX:LDA#&D0:STA!pls,X:INX:CPX#31:BMIpp1:LDY#0:LDA(pls),Y:STAno
  230   .slop INY:INY:LDA(pls),Y:STApos:INY:LDA(pls),Y:STApos+1
  240   JSRpp:INY:INY:CPYno:BMIslop
  250   JMPh7:.sgun LDA#32:STAXg:LDA#&7E:STAgunp+1:LDA#&90:STAgunp:LDA#&2F:STAgun+4:LDA#0:STAgun+3:JMPgun
  260   
  270   .h0 LDA#&20:BITsc:BNEh1:LDAgex:BNEh12:RTS
  280   .h1 LDX#0:LDY#7:JSRD%:LDA#7:LDY#&2D:LDX#&E0:JSR&FFF1:LDA#255:STAgex:LDA#&60:STAnbo:STAnp:STAmg:STAnb
  290   JSRgun:LDA#&A:STAgun+4:LDA#&10:STAgun+3:JMPgun
  300   .h12 DECgex:LDAgex:CMP#254:BNEh3:LDX#0:LDY#0:JMPD%
  310   .h3 CMP#220:BNEh4:JSRgun:LDA#&38:STAgun+3:JMPgun
  320   .h4 CMP#140:BNEh5:JSRgun:LDA#&60:STAgun+3:JMPgun
  330   .h5 CMP#1:BNEstp4:JSRgun:LDY!pls
  340   .h6 LDA(pls),Y:CMP#&C0:BNEh8:DEY:LDA(pls),Y:BPLh9:EOR#&80:STA(pls),Y:DEY:LDA(pls),Y:STApos+1:DEY:LDA(pls),Y:STApos:JSRpp:JMPh10
  350   .h8 DEY:.h9 DEY:DEY:.h10 DEY:DEY:BNEh6
  360   .h7 LDA#&20:STAmg:LDA#&A5:STAnp:LDA#&A9:STAnbo:STAnb:DECgex+1:BEQgov:SEC:LDAgex+2:SBC#&20:STAgex+2:JSRmini:JMPsgun
  370   .gov PLA:PLA:RTS
  380   .mini LDA#&C0:STAsf:LDA#9:STAsf+1:LDAgex+2:STAsd:LDAgex+3:STAsd+1:JMPpb
  390   .stp4 RTS
  400   .stp6 LDAgex:BEQstp4:LDApsta:EOR#&80:STApsta:PLA:PLA:JMPfo+3
  410   
  420   .sor LDAsc:BEQs7:SED:AND#2:BEQs1:CLC:LDA#5\pl:ADCsc+1:STAsc+1:LDAsc+2:ADC#0:STAsc+2:JSRX%
  430   .s1 LDA#&10:BITsc:BEQs2:CLC:LDA#10\pig:ADCsc+1:STAsc+1:LDAsc+2:ADC#0:STAsc+2
  440   .s2 CLD:LDA#0:STAsc:RTS
  450   .s7 LDA#&33:STAsd+1:LDA#&90:STAsd:LDA#&C:STAsf+1:LDA#&F0:ANDsc+2:JSRw:LDA#&F:ANDsc+2:ASLA:ASLA:ASLA:ASLA:JSRw
  460   LDA#&F0:ANDsc+1:JSRw:LDA#&F:ANDsc+1:ASLA:ASLA:ASLA:ASLA:JMPw
  470   .pg LDA#&B:STAsf+1:LDAba+1:BNEb0:LDA#&42:BITsc:BEQep
  480   LDA#2:BITpicn:BEQpgl
  490   LDA#&B:STAsf+1:STApg+1:LDA#&68:STAba:STAsd:LDA#0:STAxps+1:LDA#76:STAba+3:LDA#&4B:STAb5-2:BNEb3
  500   .pgl LDA#&A:STAsf+1:STApg+1:LDA#0:STAba:STAsd:STAba+3:LDA#76:STAxps+1:LDA#&49:STAb5-2
  510   .b3 LDA#0:STApy:INCpicn
  520   LDA#7:ANDra1:TAX:LDA#&49:CLC:.b5 ADC#5:TAY:LDApy:ADC#16:STApy:TYA:DEX:BPLb5:STAba+1:STAsd+1:LDX#2:STXba+2:LDAbis,X:STAsf:JMPpb:.ep RTS
  530   .b0 LDAba:STAsd:LDAba+1:STAsd+1:BPLb1:DECba+2:BNEep:EOR#&80:STAsd+1:LDA#0:STAba+1:LDA#&10:ORAsc:STAsc:BEQbx:.b1 LDAba+2:AND#&7F:TAX:LDAbis,X:STAsf:LDY#0:LDA(bulst),Y:STAno:.h INY:LDA(bulst),Y:SEC:SBCpy:BMInh:CMP#7:BPLnh
  540   INY:INY:LDA(bulst),Y:BEQnh+2:INY:LDA(bulst),Y:SEC:SBCba+3:BMInh+3:CMP#3:BPLnh+3:LDA#&E8:STA(bulst),Y:TAX:LDA#7:LDY#&2D:JSR&FFF1:LDA#&10:STAba+2:LDA#&80:ORAba+1:STAba+1:JSRpb
  550   .bx LDA#&B:STAsf+1:LDA#&70:STAsf:JMPpb:.b9 LDA#4:ORAsc:STAsc:LDA#0:STAba+1:.x RTS
  560   .nh INY:INY:INY:CPYno:BMIh:LDA#&80:EORba+2:STAba+2:BMIx:JSRpb:LDAba+3:.xps CMP#76:BEQb9:AND#31:BNEb6:LDA#7:LDY#&2D:LDX#&F0:JSR&FFF1
  570   .b6 LDXba+2:DEX:BPLb7:LDX#7:.b7 STXba+2:LDAbis,X:STAsf:LDAxps+1:BEQb10:INCba+3:CLC:LDAba:ADC#8:STAba:STAsd:BCCpb:INCba+1:INCsd+1:JMPpb
  580   .b10 DECba+3:SEC:LDAba:SBC#8:STAba:STAsd:BCSpb:DECba+1:DECsd+1
  590   .pb LDY#&17:.b8 LDA(sf),Y:EOR(sd),Y:STA(sd),Y:DEY:BPLb8:RTS
  600   ]:NEXT:VDU11:PRINT~P%
  610 !&2B4A=!&2B4A AND &FFFF0000 OR stp6:END
  620 DEFPROCI
  630 !&2D5F=&00404080:!&2D63=&80400080:?&2D67=0
  640 FORA%=&2D0ATO&2D5E:?A%=0:NEXT
  650 bfg=&71:pfg=&72:Xg=&2D70:gunp=&86:bis=&2D68:ba=&2D7C
  660 py=&7C:ra1=&7D:sd=&80:sf=&82:bulst=&8A:buf=&2D72:no=&70
  670 vs=&27C3:lg=&26B0:plf=&88:pls=&75:pos=&78:psta=&7A:bost=&8C
  680 de=&2D79:ti=&2D7A:sc=&2D76:bof=&2D74:inb=&2D71:gex=&2F28:picn=&2FC
  690 !Xg=&2F30CF20:!plf=&2F40:!bof=&2F38:!de=&420320
  700 ?bfg=2:!bulst=&2D472D0A:?&2D0A=8:?&2D47=20
  710 !pls=&2D13:?&2D13=25
  720 mg=&286E:gun=&28D3:mb=&28E2:nb=&295E
  730 np=&29F7:mp=&2A94:fo=&2BE1:pp=&2C08:nbo=&2C45:mbo=&2C98
  740 C%=&261A:D%=&281D:E%=&2835:scr=&284A:w=&285A
  750 X%=&258D:R%=&25B8:V%=&25C9
  760 ENDPROC
